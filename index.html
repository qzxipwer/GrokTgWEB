<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Neural AI</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --bg: #000;
      --text: #e0e0e0;
      --primary: #6750a4;
      --on-primary: #ffffff;
      --surface: #121212;
      --border: #333;
    }

    body {
      margin: 0;
      height: 100vh;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, sans-serif;
      overflow: hidden;
    }

    #welcome {
      position: fixed;
      inset: 0;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
      z-index: 100;
    }

    #welcome.hidden {
      display: none;
    }

    h1 { font-size: 2.8rem; margin-bottom: 20px; }
    #startBtn {
      padding: 16px 60px;
      font-size: 1.3rem;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 999px;
      cursor: pointer;
    }

    #main {
      display: none;
      height: 100vh;
      flex-direction: column;
    }

    header {
      height: 64px;
      background: #111;
      display: flex;
      align-items: center;
      padding: 0 16px;
      border-bottom: 1px solid var(--border);
    }

    .title {
      font-size: 1.3rem;
      font-weight: 600;
      flex: 1;
    }

    .icon-btn {
      width: 48px;
      height: 48px;
      background: none;
      border: none;
      font-size: 1.5rem;
      color: #aaa;
      cursor: pointer;
    }

    #messages {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .msg {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 18px;
      font-size: 1.05rem;
    }

    .user { align-self: flex-end; background: var(--primary); color: white; }
    .ai { align-self: flex-start; background: #222; color: white; }

    .file-msg {
      align-self: flex-end;
      background: #222;
      padding: 12px;
      border-radius: 12px;
      max-width: 80%;
      margin: 8px 0;
    }

    .input-area {
      padding: 16px;
      background: #111;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    #input {
      flex: 1;
      padding: 14px 18px;
      border-radius: 999px;
      border: none;
      background: #222;
      color: white;
      font-size: 1.05rem;
    }

    #sendBtn {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      border: none;
      font-size: 1.6rem;
    }
  </style>
</head>
<body>

  <div id="welcome">
    <h1>Neural AI</h1>
    <p style="font-size:1.3rem; margin:20px 0;">–ù–∞–∂–º–∏ –Ω–∏–∂–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</p>
    <button id="startBtn">–ù–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ</button>
  </div>

  <div id="main">
    <header>
      <div class="title" id="modelTitle">Groq ¬∑ Llama 3.3 70B</div>
      <button class="icon-btn" id="modelBtn">‚öôÔ∏è</button>
    </header>

    <div id="messages"></div>

    <div class="input-area">
      <button class="icon-btn" id="attachBtn">üìé</button>
      <input type="text" id="input" placeholder="–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off"/>
      <button id="sendBtn">‚û§</button>
    </div>
  </div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();

// –ó–∞–ø—É—Å–∫
document.getElementById("startBtn").addEventListener('pointerdown', e => {
  e.preventDefault();
  document.getElementById("welcome").classList.add("hidden");
  setTimeout(() => {
    document.getElementById("welcome").style.display = "none";
    document.getElementById("main").style.display = "flex";
    addMessage("–ü—Ä–∏–≤–µ—Ç! –Ø Grok –Ω–∞ Groq. –ü—Ä–∏–∫—Ä–µ–ø–∏ —Ñ–∞–π–ª –∏–ª–∏ –ø–∏—à–∏ —Ç–µ–∫—Å—Ç üöÄ", false);
    document.getElementById("input").focus();
  }, 300);
});

// –¢–µ–∫—É—â–∞—è –º–æ–¥–µ–ª—å
let currentModel = 'llama-3.3-70b-versatile';
const modelTitle = document.getElementById("modelTitle");

const models = [
  {id: 'llama-3.3-70b-versatile', name: 'Llama 3.3 70B'},
  {id: 'mixtral-8x22b-32768', name: 'Mixtral 8x22B'},
  {id: 'gemma2-9b-it', name: 'Gemma 2 9B'},
  {id: 'qwen-2.5-72b-instruct', name: 'Qwen 2.5 72B'}
];

// –°–º–µ–Ω–∞ –º–æ–¥–µ–ª–∏
document.getElementById("modelBtn").onclick = () => {
  const buttons = models.map(m => ({
    text: m.name + (m.id === currentModel ? ' ‚úì' : ''),
    id: m.id
  }));

  buttons.push({text: '–û—Ç–º–µ–Ω–∞', id: 'cancel', type: 'destructive'});

  tg.showPopup({
    title: '–í—ã–±–µ—Ä–∏ –º–æ–¥–µ–ª—å',
    buttons
  }, btn => {
    if (btn.id === 'cancel') return;
    currentModel = btn.id;
    modelTitle.textContent = `Groq ¬∑ ${models.find(m => m.id === currentModel).name}`;
    addMessage(`–ü–µ—Ä–µ–∫–ª—é—á–∞—é—Å—å –Ω–∞ ${models.find(m => m.id === currentModel).name}...`, false);
  });
};

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
document.getElementById("attachBtn").onclick = () => {
  tg.showPopup({
    title: '–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å',
    buttons: [
      {text: '–§–æ—Ç–æ/–í–∏–¥–µ–æ', id: 'photo'},
      {text: '–î–æ–∫—É–º–µ–Ω—Ç', id: 'document'},
      {text: '–ì–æ–ª–æ—Å–æ–≤–æ–µ', id: 'voice'},
      {text: '–û—Ç–º–µ–Ω–∞', id: 'cancel', type: 'destructive'}
    ]
  }, btnId => {
    if (btnId === 'cancel') return;

    tg.requestFile({
      type: btnId === 'photo' ? 'photo' :
            btnId === 'document' ? 'document' :
            btnId === 'voice' ? 'voice' : 'any'
    }, file => {
      if (!file) return;

      const div = document.createElement('div');
      div.className = 'file-msg';
      div.innerHTML = `
        <strong>–§–∞–π–ª:</strong> ${file.file_name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}<br>
        –†–∞–∑–º–µ—Ä: ${(file.file_size / 1024).toFixed(1)} KB<br>
        –¢–∏–ø: ${file.mime_type || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
      `;
      document.getElementById("messages").appendChild(div);
      document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;
    });
  });
};

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞
const input = document.getElementById("input");
const sendBtn = document.getElementById("sendBtn");

function addMessage(text, isUser = false) {
  const div = document.createElement("div");
  div.className = `msg ${isUser ? 'user' : 'ai'}`;
  div.textContent = text;
  document.getElementById("messages").appendChild(div);
  document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;
}

async function send() {
  const text = input.value.trim();
  if (!text) return;

  addMessage(text, true);
  input.value = "";
  sendBtn.disabled = true;

  try {
    const res = await fetch('https://api.groq.com/openai/v1/chat/completions', {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer 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"
      },
      body: JSON.stringify({
        model: currentModel,
        messages: [
          { role: "system", content: "–¢—ã Grok ‚Äî —á–µ—Å—Ç–Ω—ã–π –∏ –ø–æ–ª–µ–∑–Ω—ã–π –ò–ò." },
          { role: "user", content: text }
        ],
        temperature: 0.7,
        max_tokens: 1024
      })
    });

    if (!res.ok) throw new Error("–û—à–∏–±–∫–∞: " + res.status);

    const data = await res.json();
    const answer = data.choices?.[0]?.message?.content?.trim() || "...";

    addMessage(answer, false);

  } catch (e) {
    addMessage("‚ö†Ô∏è " + e.message, false);
  }

  sendBtn.disabled = false;
  input.focus();
}

sendBtn.onclick = send;
input.addEventListener("keypress", e => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    send();
  }
});
</script>
</body>
</html>
